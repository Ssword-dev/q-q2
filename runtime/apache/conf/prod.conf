Listen 80

Define SERVER_ROOT .

# on prod. the app is in dist/app
Define DOCUMENT_ROOT "../../app"

LoadModule auth_basic_module modules/mod_auth_basic.so
LoadModule authn_core_module modules/mod_authn_core.so
LoadModule authz_core_module modules/mod_authz_core.so
LoadModule authz_owner_module modules/mod_authz_owner.so
LoadModule authz_user_module modules/mod_authz_user.so

LoadModule dir_module modules/mod_dir.so
LoadModule alias_module modules/mod_alias.so
LoadModule rewrite_module modules/mod_rewrite.so
LoadModule setenvif_module modules/mod_setenvif.so
LoadModule mime_module modules/mod_mime.so
LoadModule log_config_module modules/mod_log_config.so
LoadModule php_module "../php/php8apache2_4.dll"

# caching modules.
LoadModule expires_module modules/mod_expires.so
LoadModule headers_module modules/mod_headers.so
# LoadModule cache_module modules/mod_cache.so
# LoadModule cache_disk_module modules/mod_cache_disk.so

Include conf/mime.conf

<VirtualHost *:80>
    ServerRoot "${SERVER_ROOT}"
    DocumentRoot "${DOCUMENT_ROOT}"

    # logging

    <IfModule log_config_module>
        # logging format.
        LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
        LogFormat "%h %l %u %t \"%r\" %>s %b" common

        <IfModule logio_module>
          LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" %I %O" combinedio
        </IfModule>

        # where non error logs go.
        CustomLog "logs/access.log" common
    </IfModule>

    # handlers

    AddHandler application/x-httpd-php .php
    PHPIniDir "../php"

    Alias "/api/" "../../api/"

    # CGI script alias configuration

    ScriptAlias /cgi-bin/ "${SERVER_ROOT}/cgi-bin/"

    # CGI directory permissions

    <Directory "${SERVER_ROOT}/cgi-bin">
        AllowOverride None
        Options None
        Require all granted
    </Directory>

    # client caching


    ExpiresActive On

    # expire other files by one month by default.

    ExpiresDefault "access plus 1 month"

    # specific client caching rules

    ExpiresByType text/html "access plus 1 hour"
    ExpiresByType text/css "access plus 1 year"
    ExpiresByType application/javascript "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType font/woff2 "access plus 1 year"
    ExpiresByType font/woff "access plus 1 year"

    <FilesMatch "\.(js|css|png|jpg|jpeg|gif|svg|webp|woff|woff2)$">
        Header set Cache-Control "public, max-age=31536000, immutable"
    </FilesMatch>

    # server caching

    # # this should resolve to {dist}/runtime/apache/cache
    # CacheRoot "./cache"
    # CacheEnable disk "/"

    # # only cache files larger than 10mb.
    # # is not worth it to cache small files.
    # CacheMinFileSize 10000000

    # # only cache files smaller than 10mb.
    # # if *any* of the files served to the client
    # # is bigger than 1 gb. maybe... just maybe...
    # # reconsider the choices made along the way.
    # CacheMaxFileSize 1000000000
</VirtualHost>